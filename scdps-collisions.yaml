project_name: "scdps-collisions"

plugins_dir:
  - ".installed_plugins"
  - "plugins"

plugins:
  - "clone"

pipes:
  - connector: "plugin:scdps"
    metric: "collisions"
    location: "sc"
    columns:
      datetime: "CrashDate"
      accident_number: "AccidentNumber"
      object_id: "OBJECTID"
    indices:
      county: "County"
    parameters:
      verify:
        chunk_days: 365
    dtypes:
      'X': 'float64'
      'Y': 'float64'
      'OBJECTID': 'Int64'
      'AccidentNumber': 'Int64'
      'CrashDate': 'datetime64[ns]'
      'hour': 'Int64'
      'NumberOfUnits': 'Int64'
      'NumberOfFatalities': 'Int64'
      'NumberOfInjuries': 'Int64'
      'Possible_Injuries': 'Int64'
      'Suspected_Minor_Injuries': 'Int64'
      'Suspected_Serious_Injuries': 'Int64'
      'Latitude': 'numeric'
      'Longitude': 'numeric'
      'CMV': 'Int64'
      'TotalNumberOfOccupants': 'Int64'
      'Year': 'Int64'
      'MonthNumber': 'Int64'

  - connector: "sql:traffic"
    metric:  "collisions"
    location: "greenville"
    columns:
      datetime: "CrashDate"
      primary: "AccidentNumber"
      object_id: "OBJECTID"
    parameters:
      query: |-
        SELECT *
        FROM {{Pipe('plugin:scdps', 'collisions', 'sc')}}
        WHERE "County" = 'Greenville'

  - connector: "plugin:clone"
    metric: "collisions"
    location: "greenville"
    columns:
      datetime: "CrashDate"
      accident_number: "AccidentNumber"
      object_id: "OBJECTID"
    parameters:
      sources:
        - pipe:
            connector: "sql:traffic"
            metric: "collisions"
            location: "greenville"
          params:
            County: "Greenville"
      verify:
        chunk_days: 365


config:
  meerschaum:
    instance: "sql:traffic"
    connectors:
      sql:
        traffic: MRSM{meerschaum:connectors:sql:main}
