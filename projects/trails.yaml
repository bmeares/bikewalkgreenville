project_name: trails

root_dir: ../root

plugins_dir:
- ../.installed_plugins
- ../plugins

pipes:

- connector: "sql:bwg"
  metric: "trails"
  location: "proposed"
  instance: "sql:trails"
  parameters:
    target: "ProposedTrails"
    columns:
      datetime: "id"
      primary: "id"
    dtypes:
      id: "int"
      geometry: "geometry[LineString,3361]"
    sql: |-
      SELECT
        "STATUS",
        "SYSTEM_NAM",
        "TRAIL_NAME",
        "TRAIL_TYPE",
        NULL::TEXT AS "notes",
        ST_Length("geometry") AS "Shape_Leng",
        "geometry"
      FROM city."Trails"
      WHERE "STATUS" = 'PROPOSED'
      UNION ALL
      SELECT
        "STATUS",
        "SYSTEM_NAM",
        "TRAIL_NAM" AS "TRAIL_NAME",
        "TRAIL_TYPE",
        "notes",
        ST_Length("geometry") AS "Shape_Leng",
        "geometry"
      FROM city."ApprovedTrails"

config:
  meerschaum:
    instance: sql:bwg
    connectors:
      sql:
        bwg: MRSM{meerschaum:connectors:sql:bwg}
        trails:
          flavor: geopackage
          database: '{MRSM_ROOT_DIR}/../data/output/trails.gpkg'
  plugins:
    bwg:
      data_path: '{MRSM_ROOT_DIR}/../data'
